import{a as J}from"./chunk-RMDRK64P.js";import{a as z}from"./chunk-PVJ7IEF6.js";import{a as B}from"./chunk-NHY6G2KS.js";import{a as L}from"./chunk-IDCAQ4EK.js";import"./chunk-2PNSS65N.js";import{b as x,c as M,d as q,e as O,f as h,g as j,j as V,k as H,l as R,m as A,n as G,p as D,r as $}from"./chunk-BZHRZEYF.js";import{a as N}from"./chunk-67ANC6KW.js";import{j as T}from"./chunk-6X3NTM2I.js";import{Ab as u,Ib as c,Jb as f,Kb as E,Qb as I,Sa as a,Ta as g,ga as b,gb as d,ib as l,jc as F,kc as k,lc as w,pa as S,qa as C,qb as n,rb as o,sb as v,vb as y,yb as _}from"./chunk-QODOQ2ZI.js";function P(e,s){if(e&1&&(n(0,"option",16),c(1),o()),e&2){let i=s.$implicit;l("value",i.id),a(),f(i.nombre)}}function Q(e,s){e&1&&(n(0,"p",18),c(1,"El hospital es requerido"),o())}function U(e,s){if(e&1&&(n(0,"div"),d(1,Q,2,0,"p",17),o()),e&2){let i=u(2);a(),l("ngIf",i.Form.controls.id_hospital.errors.required)}}function W(e,s){if(e&1&&(n(0,"div")(1,"label",7),c(2,"Hospital"),o(),n(3,"div",11)(4,"select",15),d(5,P,2,2,"option",13),o(),d(6,U,2,1,"div",6),o()()),e&2){let i=u();a(5),l("ngForOf",i.hospitales),a(),l("ngIf",i.Form.controls.id_hospital.errors&&i.Form.controls.id_hospital.touched)}}function X(e,s){if(e&1){let i=y();n(0,"div")(1,"label")(2,"input",19),_("change",function(t){let r=S(i).$implicit,p=u();return C(p.agregarSensor(t,r.id))}),o(),c(3),o()()}if(e&2){let i=s.$implicit;a(2),l("value",i.id),a(),E(" ",i.nombre," ")}}function Y(e,s){e&1&&(n(0,"div")(1,"p",18),c(2,"Al menos 1 sensor es requerido"),o()())}function Z(e,s){if(e&1&&(n(0,"option",16),c(1),o()),e&2){let i=s.$implicit;l("value",i.id),a(),f(i.estado)}}function ee(e,s){e&1&&(n(0,"p",18),c(1,"El estado es requerido"),o())}function te(e,s){if(e&1&&(n(0,"div"),d(1,ee,2,0,"p",17),o()),e&2){let i=u();a(),l("ngIf",i.Form.controls.id_estado.errors.required)}}function ie(e,s){if(e&1&&(n(0,"div")(1,"p",20),c(2),o()()),e&2){let i=u();a(2),f(i.succesMessages.message)}}function oe(e,s){if(e&1&&(n(0,"div")(1,"p",18),c(2),o()()),e&2){let i=u();a(2),f(i.backendErrors.message)}}var fe=(()=>{let s=class s{constructor(m,t,r,p,K){this.router=m,this.incubadorasService=t,this.hospitalesService=r,this.sensoresService=p,this.cookies=K,this.hospitales=[],this.estados=[],this.sensoresSeleccionados=[],this.sensores=[],this.backendErrors={},this.succesMessages={},this.Form=new O({id_hospital:new h(""),id_estado:new h("",[x.required]),id_sensores:new h([],[x.required])})}ngAfterContentInit(){this.id_rol=this.cookies.get("id_rol");let m=this.cookies.get("id_hospital");this.hospitalesService.getHospitales().subscribe({next:t=>{let r=Number(this.cookies.get("id_hospital"));this.hospitales=t.Hospitales.filter(p=>p.is_active&&Number(p.id)===r),console.log(this.hospitales)},error:t=>{console.log(t)}}),this.sensoresService.getSensores().subscribe({next:t=>{console.log(t),this.sensores=t.data,console.log(this.sensores)},error:t=>{console.log(t)}}),this.incubadorasService.getEstadosIncubadora().subscribe({next:t=>{this.estados=t.estado,console.log(this.estados)},error:t=>{console.log(t)}})}agregarSensor(m,t){if(m.target.checked)this.sensoresSeleccionados.push(t);else{let p=this.sensoresSeleccionados.indexOf(t);p>-1&&this.sensoresSeleccionados.splice(p,1)}let r=this.Form.get("id_sensores");r&&r.setValue(this.sensoresSeleccionados)}crearIncubadora(){if(console.log(this.Form.value),console.log("ID del hospital seleccionado:",this.Form.value.id_hospital),console.log("Sensores seleccionados:",this.sensoresSeleccionados),this.Form.valid&&this.sensoresSeleccionados.length>0){if(!this.findHospitalById(this.Form.value.id_hospital)){this.backendErrors={message:"Hospital no encontrado"};return}this.incubadorasService.createIncubadora(this.Form.value).subscribe({next:t=>{this.succesMessages.message="Incubadora creada con \xE9xito",this.backendErrors="",setTimeout(()=>{this.router.navigate(["/incubadoras"]),this.succesMessages=""},3e3),console.log(t)},error:t=>{this.backendErrors=t.error,this.succesMessages="",this.backendErrors={message:"Error al crear incubadora, intente m\xE1s tarde"},console.log(t)}})}else this.backendErrors={message:"Al menos 1 sensor es requerido"}}findHospitalById(m){return this.hospitales.find(t=>Number(t.id)===Number(m))}};s.\u0275fac=function(t){return new(t||s)(g(T),g(J),g(B),g(L),g(N))},s.\u0275cmp=b({type:s,selectors:[["app-create"]],standalone:!0,features:[I],decls:26,vars:8,consts:[[1,"flex","mt-10","flex-col","justify-center"],[1,"sm:mx-auto","sm:w-1/2","sm:max-w-2xl"],["src","assets/logo.jpeg","alt","Logo",1,"mx-auto","h-32","w-auto"],[1,"mt-3","text-center","text-2xl","font-bold","leading-9","tracking-tight","text-violet-950"],[1,"sm:mx-auto","sm:w-1/3","sm:max-w-2xl"],[1,"space-y-2",3,"formGroup"],[4,"ngIf"],["for","hospital",1,"block","text-sm","font-medium","leading-6","text-gray-900"],[1,"grid","grid-cols-3","gap-4"],[4,"ngFor","ngForOf"],["for","maintenance",1,"block","text-sm","font-medium","leading-6","text-gray-900"],[1,"mt-2"],["formControlName","id_estado","name","maintenance","required","",1,"pl-3","block","w-full","rounded-md","border-0","py-1.5","text-gray-900","shadow-sm","ring-1","ring-inset","ring-gray-300","placeholder:text-gray-400","focus:ring-2","focus:ring-inset","focus:ring-indigo-600","sm:text-sm","sm:leading-6"],[3,"value",4,"ngFor","ngForOf"],["type","submit",1,"flex","w-full","justify-center","rounded-md","bg-fuchsia-500","px-3","py-1.5","text-sm","font-semibold","leading-6","text-white","shadow-sm","hover:bg-cyan-700","focus-visible:outline","focus-visible:outline-2","focus-visible:outline-offset-2","focus-visible:outline-indigo-600",3,"click"],["formControlName","id_hospital","name","hospital","required","",1,"pl-3","block","w-full","rounded-md","border-0","py-1.5","text-gray-900","shadow-sm","ring-1","ring-inset","ring-gray-300","placeholder:text-gray-400","focus:ring-2","focus:ring-inset","focus:ring-indigo-600","sm:text-sm","sm:leading-6"],[3,"value"],["class","text-red-500 font-medium text-sm",4,"ngIf"],[1,"text-red-500","font-medium","text-sm"],["type","checkbox",3,"change","value"],[1,"text-green-500","font-medium","text-sm"]],template:function(t,r){t&1&&(v(0,"app-toolbar"),n(1,"div",0)(2,"div",1),v(3,"img",2),n(4,"h2",3),c(5,"Registrar Incubadora"),o()(),n(6,"div",4)(7,"form",5),d(8,W,7,2,"div",6),n(9,"label",7),c(10,"Agregar Sensores"),o(),n(11,"div",8),d(12,X,4,2,"div",9),o(),d(13,Y,3,0,"div",6),n(14,"div")(15,"label",10),c(16,"Estado del Mantenimiento"),o(),n(17,"div",11)(18,"select",12),d(19,Z,2,2,"option",13),o(),d(20,te,2,1,"div",6),o()(),d(21,ie,3,1,"div",6)(22,oe,3,1,"div",6),n(23,"div")(24,"button",14),_("click",function(){return r.crearIncubadora()}),c(25,"Registrar Incubadora"),o()()()()()),t&2&&(a(7),l("formGroup",r.Form),a(),l("ngIf",r.id_rol==1),a(4),l("ngForOf",r.sensores),a(),l("ngIf",r.sensoresSeleccionados.length===0),a(6),l("ngForOf",r.estados),a(),l("ngIf",r.Form.controls.id_estado.errors&&r.Form.controls.id_estado.touched),a(),l("ngIf",r.succesMessages.message),a(),l("ngIf",r.backendErrors.message))},dependencies:[z,$,j,A,G,R,M,q,D,V,H,w,F,k]});let e=s;return e})();export{fe as CreateComponent};
